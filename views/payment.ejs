<!DOCTYPE html>
<html>
  <title>Stripe Payment Demo</title>
  <head>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link href="style.css" type="text/css" rel="stylesheet" />
  </head>
  <body>
    <h3>Stripe Payment Gateway</h3>
    <script src="https://js.stripe.com/v3"></script>

    <div class="row">
        <form action="/paymentMethod" method="post">

        <div class="col-md-5 sec-add-con">
          <div class="pay-address">
            <h4>Address:</h4>
            <label for="email">Email</label>
            <input type="text" name="email" id="email" /><br><br>
            <label for="name">Name</label>
            <input type="text" name="name" id="name"/><br><br>
            <label for="phone">Phone</label>
            <input type="text" name="phone" id="phone"/><br><br>
            <label for="city">City</label>
            <input type="text" name="city" id="city" /><br><br>
            <label for="state">State</label>
            <input type="text" name="state" id="state" /><br><br>
            <label for="country">Country</label>
            <input type="text" name="country" id="country" /><br><br>
            <label for="postal_code">Postal code</label>
            <input type="text" name="postal_code" id="postal_code" /><br><br>
          </div>
        </div>

        <div class="col-md-5 sec-card-con">
          <div class="pay-card-details">
            <h4>Card Details:</h4>
            <label for="number">Card number:</label>
            <input type="text" id="number" name="number"><br><br>
            <label for="exp_month">Expiry month:</label>
            <input type="number" id="exp_month" name="exp_month" max="2"><br><br>
            <label for="exp_year">Year:</label>
            <input type="number" id="exp_year" name="exp_year" max="4"><br><br>
            <label for="cvc">cvc:</label>
            <input type="number" id="cvc" name="cvc"><br><br>
            <input type="submit" value="Submit">
          </div>
        </div>

    </form>

    </div>
    <script>
      ​
        function login() {
      ​
          $('.secondlyValidatableInput input').keydown(event => {
            $(event.target).parent().parent().removeClass('error')
          })
          const email = $('#loginEmail').val()
          const text = $('#loginPass').val()
          const remember = $('#remember').is(':checked')

          fetch('/api/account/login', {
              method: 'POST',
              credentials: 'same-origin',
              // xhrFields: { withCredentials: true },
              // headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email, text})
            })
              .then((response) => {
                return response.json()
              })
              .then(body => {
                console.log(body)
                if (body.success) {
                  if (body.user.admin) window.location.replace('/admin')
                  else window.location.replace('/')
                } else {
                  // there was an error
                  if (body.message) alert(body.message)
                  for (let fieldError of body.fields) {
                    const validatableInput = $(`.secondlyValidatableInput.${fieldError.name}`)
                    validatableInput.addClass('error')
                    validatableInput.find('.secondlyErrorMessage').text(fieldError.message)
                  }
                }
              })
              .catch(function(error) {
                console.log(error)
                alert('There was an error. Please try again.')
              })
        }
    </script>
  </body>
</html>
